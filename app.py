import streamlit as st
import numpy as np
import pandas as pd
from sklearn.cluster import KMeans

# ---------------------------------------------
# 1) í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
# ---------------------------------------------
st.set_page_config(page_title="AI StudyMate - í•™ìŠµ ì„±í–¥ ë¶„ì„ ë°ëª¨", layout="wide")

st.title("ğŸ§  AI StudyMate - í•™ìŠµ ì„±í–¥ ì§„ë‹¨ ë°ëª¨")
st.write("30ë¬¸í•­ ì„¤ë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµ ì„±í–¥ì„ ë¶„ì„í•˜ê³ , ë§ì¶¤í˜• í•˜ë¸Œë£¨íƒ€ íŒŒíŠ¸ë„ˆ ìœ í˜•ì„ ì¶”ì²œí•©ë‹ˆë‹¤.")

st.divider()

# ---------------------------------------------
# 2) ì„¤ë¬¸ ë¬¸í•­ ì •ì˜ (Q1~Q30)
# ---------------------------------------------
questions = [
    "ë‚˜ëŠ” ë¬¸ì œë¥¼ í’€ê¸° ì „ì— ê³„íšì„ ì„¸ìš°ëŠ” í¸ì´ë‹¤.",
    "ìƒˆë¡œìš´ ë‚´ìš©ì„ ë°°ìš°ë©´ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬í•´ë³´ëŠ” í¸ì´ë‹¤.",
    "ì–´ë ¤ìš´ ë¬¸ì œê°€ ë‚˜ì˜¤ë©´ ë°”ë¡œ ì§ˆë¬¸í•˜ê¸°ë³´ë‹¤ëŠ” ë¨¼ì € ìŠ¤ìŠ¤ë¡œ í•´ê²°í•˜ë ¤ í•œë‹¤.",
    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•˜ë©´ ë” ì˜ ì´í•´ëœë‹¤.",
    "ë‹¤ë¥¸ ì‚¬ëŒì˜ ìƒê°ì„ ë“£ê³  ë¹„êµí•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
    "í† ë¡  í™œë™ì´ ë‚˜ì—ê²Œ ë„ì›€ì´ ëœë‹¤.",
    "ë‚˜ëŠ” í˜¼ì ê³µë¶€í•˜ëŠ” ê²ƒì´ ë” í¸í•˜ë‹¤.",
    "í•™ìŠµ ëª©í‘œë¥¼ ìŠ¤ìŠ¤ë¡œ ì„¤ì •í•˜ëŠ” í¸ì´ë‹¤.",
    "í‹€ë¦° ë¬¸ì œë¥¼ ë‹¤ì‹œ ë¶„ì„í•˜ëŠ” ë° ì‹œê°„ì„ íˆ¬ìí•œë‹¤.",
    "ë‚´ê°€ ëª¨ë¥´ëŠ” ê²ƒì„ ì†”ì§í•˜ê²Œ ë§í•˜ëŠ” í¸ì´ë‹¤.",
    "ì¹œêµ¬ê°€ ì§ˆë¬¸í•˜ë©´ ì‰½ê²Œ ì„¤ëª…í•´ì£¼ëŠ” í¸ì´ë‹¤.",
    "íŒ€ í™œë™ì—ì„œ ì˜ê²¬ ì¡°ìœ¨ì„ ì˜í•˜ëŠ” í¸ì´ë‹¤.",
    "ë¬¸ì œë¥¼ ë‹¤ì–‘í•˜ê²Œ ë°”ê¿”ë³´ë©° íƒêµ¬í•˜ëŠ” í¸ì´ë‹¤.",
    "ìƒˆë¡œìš´ ë°©ì‹ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
    "ì›ë¦¬ë¥¼ ì´í•´í•´ì•¼ ì•ˆì‹¬ëœë‹¤.",
    "ë‚˜ì˜ í•™ìŠµ ìŠµê´€ì„ ìŠ¤ìŠ¤ë¡œ ì ê²€í•œë‹¤.",
    "í•™ìŠµ ìŠ¤ì¼€ì¤„ì„ ì§€í‚¤ë ¤ê³  ë…¸ë ¥í•œë‹¤.",
    "ëª¨ë¥´ëŠ” ê²ƒì´ ìˆìœ¼ë©´ ë°”ë¡œ ê²€ìƒ‰í•˜ê±°ë‚˜ ì°¾ëŠ”ë‹¤.",
    "ì¹œêµ¬ì™€ ì•„ì´ë””ì–´ë¥¼ ì£¼ê³ ë°›ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
    "ì„œë¡œì˜ í’€ì´ë¥¼ ë¹„êµí•´ë³´ëŠ” í™œë™ì„ ì¢‹ì•„í•œë‹¤.",
    "ì§ˆë¬¸ì„ í™œë°œí•˜ê²Œ í•˜ëŠ” í¸ì´ë‹¤.",
    "ë¬¸ì œì˜ ë‹¤ì–‘í•œ ê²½ìš°ë¥¼ ì‹¤í—˜í•˜ëŠ” í¸ì´ë‹¤.",
    "ë³µì¡í•œ ë¬¸ì œë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ìƒê°í•œë‹¤.",
    "ë‚´ê°€ ì´í•´í•œ ê²ƒì„ ì •ë¦¬í•´ì„œ ë§í•  ìˆ˜ ìˆë‹¤.",
    "ìˆ˜ì—… ì¤‘ ë°œí‘œë‚˜ ì„¤ëª…ì„ ì˜í•˜ëŠ” í¸ì´ë‹¤.",
    "ì˜¤ë‹µì„ ë¶„ì„í•˜ì—¬ ê³µë¶€ ë°©í–¥ì„ ì¡°ì •í•œë‹¤.",
    "ëª¨ë‘  í™œë™ì—ì„œ ì£¼ë„ì ìœ¼ë¡œ ì°¸ì—¬í•œë‹¤.",
    "ì–´ë ¤ìš´ ë‚´ìš©ì„ ë°˜ë³µí•´ì„œ íƒêµ¬í•´ë³¸ë‹¤.",
    "ë°°ìš´ ë‚´ìš©ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì„¤ëª…í•´ë³¸ë‹¤.",
    "ë‹¤ë¥¸ ì‚¬ëŒê³¼ í•™ìŠµí•  ë•Œ ë™ê¸°ë¶€ì—¬ê°€ ëœë‹¤."
]


st.subheader("ğŸ“˜ í•™ìŠµ ì„±í–¥ ì„¤ë¬¸ (30ë¬¸í•­)")

# 5ì  ë¦¬ì»¤íŠ¸ìš© ì„ íƒì§€
CHOICES = ["â‘  ì „í˜€ ì•„ë‹ˆë‹¤", "â‘¡ ì•„ë‹ˆë‹¤", "â‘¢ ë³´í†µì´ë‹¤", "â‘£ ê·¸ë ‡ë‹¤", "â‘¤ ë§¤ìš° ê·¸ë ‡ë‹¤"]

responses = {}

for i, question in enumerate(questions, start=1):
    st.write(f"**Q{i}. {question}**")
    choice = st.radio(
        "",
        CHOICES,
        key=f"q_{i}",
        horizontal=True  # ê°€ë¡œë¡œ ë°°ì¹˜ë˜ì–´ â—‹ â—‹ â—‹ â—‹ â—‹ ë‚˜ì˜¤ë„ë¡
    )
    responses[f"Q{i}"] = CHOICES.index(choice) + 1  # ì‹¤ì œ ê°’ì€ 1~5
    st.markdown("---")


# ---------------------------------------------
# 3) ì—­ëŸ‰ ì ìˆ˜ ê³„ì‚° (Analytical, Collaborative, SelfDirected, Questioning)
# ---------------------------------------------
if st.button("ğŸ§ª í•™ìŠµ ì„±í–¥ ë¶„ì„ ì‹œì‘"):

    # dict -> ë¦¬ìŠ¤íŠ¸ ë³€í™˜ (Q1~Q30 ìˆœì„œëŒ€ë¡œ)
    response_list = [responses[f"Q{i}"] for i in range(1, 31)]

    # ë‹¨ìˆœ ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì—­ëŸ‰ ê³„ì‚°
    Analytical_idx = [0, 2, 8, 14, 22]     # ë¶„ì„ì„± ê´€ë ¨ ë¬¸í•­
    Collaborative_idx = [3, 4, 10, 11, 18, 19, 25]  # í˜‘ë ¥ì„±
    SelfDirected_idx = [1, 6, 7, 15, 16, 26]         # ìê¸°ì£¼ë„
    Questioning_idx = [5, 12, 13, 20, 21, 27, 28]    # ì§ˆë¬¸/íƒêµ¬

    Analytical = np.mean([response_list[i] for i in Analytical_idx])
    Collaborative = np.mean([response_list[i] for i in Collaborative_idx])
    SelfDirected = np.mean([response_list[i] for i in SelfDirected_idx])
    Questioning = np.mean([response_list[i] for i in Questioning_idx])


    profile_vector = np.array([Analytical, Collaborative, SelfDirected, Questioning]).reshape(1, -1)

    # ---------------------------------------------
    # 4) K-means êµ°ì§‘ ëª¨ë¸ (ë°ëª¨ìš© ëœë¤ ì´ˆê¸° ëª¨ë¸)
    # ì‹¤ì œ í•™ìŠµ ëª¨ë¸ ì‚¬ìš© ì‹œ â†’ KMeans.load(...) or pickle ì‚¬ìš©
    # ---------------------------------------------
    kmeans = KMeans(n_clusters=4, random_state=42)
    sample_data = np.random.rand(200, 4) * 5   # ë°ëª¨ìš© ì„ì‹œ í•™ìŠµ
    kmeans.fit(sample_data)

    cluster = kmeans.predict(profile_vector)[0]

    # ---------------------------------------------
    # 5) êµ°ì§‘ëª… ë§¤í•‘ (ë‹¹ì‹ ì˜ ì‹¤ì œ êµ°ì§‘êµ¬ì¡° ê¸°ë°˜)
    # ---------------------------------------------
    cluster_name = {
        0: "ê¸°ì´ˆ ì—­ëŸ‰ í˜•ì„± ë‹¨ê³„í˜• (Foundation Stage)",
        1: "ìê¸°ì£¼ë„Â·ë…¼ë¦¬ ì„ í˜¸í˜• (Independent Analytical)",
        2: "í˜‘ë ¥Â·ê´€ê³„ ì¤‘ì‹¬í˜• (Collaborative Communicator)",
        3: "íƒêµ¬Â·ë¬¸ì œ í•´ê²° ìƒìœ„í˜• (Analytical Problem Solver)"
    }.get(cluster, "Unknown")

    # ---------------------------------------------
    # 6) í•˜ë¸Œë£¨íƒ€ íŒŒíŠ¸ë„ˆ ìœ í˜• ì¶”ì²œ ë¡œì§
    # (ìƒí˜¸ë³´ì™„ì„± ì›ì¹™ ê¸°ë°˜)
    # ---------------------------------------------
    partner_recommendation = {
        0: "í•™ìŠµ ë£¨í‹´ì´ ì˜ ì¡í˜€ ìˆëŠ” 'ìê¸°ì£¼ë„í˜•' ì¹œêµ¬ì™€ í•¨ê»˜í•˜ë©´ ê¸°ë³¸ê¸° í˜•ì„±ì´ ë¹ ë¦…ë‹ˆë‹¤.",
        1: "í˜‘ë ¥Â·ì†Œí†µì´ ê°•í•œ 'ê´€ê³„ ì¤‘ì‹¬í˜•' ì¹œêµ¬ì™€ í˜ì–´ë¥¼ ì´ë£¨ë©´ ì´í•´í­ì´ ë„“ì–´ì§‘ë‹ˆë‹¤.",
        2: "'íƒêµ¬í˜•/ë¶„ì„í˜•' ì¹œêµ¬ì™€ í•¨ê»˜í•˜ë©´ ì‚¬ê³ ë ¥ì´ ê· í˜• ìˆê²Œ ì„±ì¥í•©ë‹ˆë‹¤.",
        3: "í˜‘ë ¥ ì¤‘ì‹¬í˜• ì¹œêµ¬ì™€ í•¨ê»˜ í™œë™í•˜ë©´ ì„¤ëª…ë ¥Â·ì†Œí†µë ¥ì´ ë³´ì™„ë©ë‹ˆë‹¤."
    }[cluster]

    # ---------------------------------------------
    # 7) ê²°ê³¼ ì¶œë ¥
    # ---------------------------------------------
    st.subheader("ğŸ“Œ ë¶„ì„ ê²°ê³¼ ìš”ì•½")
    st.metric("ì˜ˆì¸¡ëœ í•™ìŠµì ìœ í˜•", cluster_name)

    col1, col2 = st.columns(2)

    with col1:
        st.write("### ğŸ¯ ë‚˜ì˜ ì—­ëŸ‰ ì ìˆ˜")
        st.write(f"- **Analytical(ë¶„ì„ì„±)**: {Analytical:.2f}")
        st.write(f"- **Collaborative(í˜‘ë ¥ì„±)**: {Collaborative:.2f}")
        st.write(f"- **Self-Directed(ìê¸°ì£¼ë„)**: {SelfDirected:.2f}")
        st.write(f"- **Questioning(íƒêµ¬Â·ì§ˆë¬¸ì„±)**: {Questioning:.2f}")

    with col2:
        st.write("### ğŸ¤ ì¶”ì²œ í•˜ë¸Œë£¨íƒ€ íŒŒíŠ¸ë„ˆ ìœ í˜•")
        st.info(partner_recommendation)

    st.divider()

    # ---------------------------------------------
    # 8) ì—­ëŸ‰ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì¶œë ¥
    # ---------------------------------------------
    st.subheader("ğŸ“‡ ë‚˜ì˜ Strength Profile ì¹´ë“œ")

    st.success(f"""
**í•™ìŠµì ìœ í˜•: {cluster_name}**

- ë¶„ì„ì  ì‚¬ê³  ìˆ˜ì¤€: **{Analytical:.1f} / 5**
- í˜‘ë ¥ ì„±í–¥: **{Collaborative:.1f} / 5**
- ìê¸°ì£¼ë„: **{SelfDirected:.1f} / 5**
- íƒêµ¬Â·ì§ˆë¬¸ ìˆ˜ì¤€: **{Questioning:.1f} / 5**

ğŸ“Œ *AI StudyMateëŠ” ì´ í”„ë¡œí•„ì„ ê¸°ë°˜ìœ¼ë¡œ  
ìµœì ì˜ í•˜ë¸Œë£¨íƒ€ íŒŒíŠ¸ë„ˆì™€ í•™ìŠµ ê·¸ë£¹ì„ ì¶”ì²œí•©ë‹ˆë‹¤.*
""")
