import streamlit as st
import numpy as np
import joblib
from partner_matching import match_partners
import pandas as pd

# ---------------------------------------------
# 1) í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
# ---------------------------------------------
st.set_page_config(page_title="AI StudyMate - í•™ìŠµ ì„±í–¥ ë¶„ì„", layout="wide")
st.title("ğŸ§  AI StudyMate - í•™ìŠµ ì„±í–¥ ì§„ë‹¨")
st.write("30ë¬¸í•­ ì„¤ë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµ ì„±í–¥ì„ ë¶„ì„í•˜ê³ , ë§ì¶¤í˜• í•˜ë¸Œë£¨íƒ€ íŒŒíŠ¸ë„ˆ ìœ í˜•ê³¼ í•™ìŠµë²•ì„ ì¶”ì²œí•©ë‹ˆë‹¤.")
st.divider()

# ---------------------------------------------
# 2) ì„¤ë¬¸ ë¬¸í•­ ì •ì˜ (Q1~Q30)
# ---------------------------------------------
questions = [
    "ë‚˜ëŠ” ë¬¸ì œë¥¼ í’€ê¸° ì „ì— ê³„íšì„ ì„¸ìš°ëŠ” í¸ì´ë‹¤.",
    "ìƒˆë¡œìš´ ë‚´ìš©ì„ ë°°ìš°ë©´ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬í•´ë³´ëŠ” í¸ì´ë‹¤.",
    "ì–´ë ¤ìš´ ë¬¸ì œê°€ ë‚˜ì˜¤ë©´ ë°”ë¡œ ì§ˆë¬¸í•˜ê¸°ë³´ë‹¤ëŠ” ë¨¼ì € ìŠ¤ìŠ¤ë¡œ í•´ê²°í•˜ë ¤ í•œë‹¤.",
    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•˜ë©´ ë” ì˜ ì´í•´ëœë‹¤.",
    "ë‹¤ë¥¸ ì‚¬ëŒì˜ ìƒê°ì„ ë“£ê³  ë¹„êµí•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
    "í† ë¡  í™œë™ì´ ë‚˜ì—ê²Œ ë„ì›€ì´ ëœë‹¤.",
    "ë‚˜ëŠ” í˜¼ì ê³µë¶€í•˜ëŠ” ê²ƒì´ ë” í¸í•˜ë‹¤.",
    "í•™ìŠµ ëª©í‘œë¥¼ ìŠ¤ìŠ¤ë¡œ ì„¤ì •í•˜ëŠ” í¸ì´ë‹¤.",
    "í‹€ë¦° ë¬¸ì œë¥¼ ë‹¤ì‹œ ë¶„ì„í•˜ëŠ” ë° ì‹œê°„ì„ íˆ¬ìí•œë‹¤.",
    "ë‚´ê°€ ëª¨ë¥´ëŠ” ê²ƒì„ ì†”ì§í•˜ê²Œ ë§í•˜ëŠ” í¸ì´ë‹¤.",
    "ì¹œêµ¬ê°€ ì§ˆë¬¸í•˜ë©´ ì‰½ê²Œ ì„¤ëª…í•´ì£¼ëŠ” í¸ì´ë‹¤.",
    "íŒ€ í™œë™ì—ì„œ ì˜ê²¬ ì¡°ìœ¨ì„ ì˜í•˜ëŠ” í¸ì´ë‹¤.",
    "ë¬¸ì œë¥¼ ë‹¤ì–‘í•˜ê²Œ ë°”ê¿”ë³´ë©° íƒêµ¬í•˜ëŠ” í¸ì´ë‹¤.",
    "ìƒˆë¡œìš´ ë°©ì‹ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
    "ì›ë¦¬ë¥¼ ì´í•´í•´ì•¼ ì•ˆì‹¬ëœë‹¤.",
    "ë‚˜ì˜ í•™ìŠµ ìŠµê´€ì„ ìŠ¤ìŠ¤ë¡œ ì ê²€í•œë‹¤.",
    "í•™ìŠµ ìŠ¤ì¼€ì¤„ì„ ì§€í‚¤ë ¤ê³  ë…¸ë ¥í•œë‹¤.",
    "ëª¨ë¥´ëŠ” ê²ƒì´ ìˆìœ¼ë©´ ë°”ë¡œ ê²€ìƒ‰í•˜ê±°ë‚˜ ì°¾ëŠ”ë‹¤.",
    "ì¹œêµ¬ì™€ ì•„ì´ë””ì–´ë¥¼ ì£¼ê³ ë°›ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
    "ì„œë¡œì˜ í’€ì´ë¥¼ ë¹„êµí•´ë³´ëŠ” í™œë™ì„ ì¢‹ì•„í•œë‹¤.",
    "ì§ˆë¬¸ì„ í™œë°œí•˜ê²Œ í•˜ëŠ” í¸ì´ë‹¤.",
    "ë¬¸ì œì˜ ë‹¤ì–‘í•œ ê²½ìš°ë¥¼ ì‹¤í—˜í•˜ëŠ” í¸ì´ë‹¤.",
    "ë³µì¡í•œ ë¬¸ì œë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ìƒê°í•œë‹¤.",
    "ë‚´ê°€ ì´í•´í•œ ê²ƒì„ ì •ë¦¬í•´ì„œ ë§í•  ìˆ˜ ìˆë‹¤.",
    "ìˆ˜ì—… ì¤‘ ë°œí‘œë‚˜ ì„¤ëª…ì„ ì˜í•˜ëŠ” í¸ì´ë‹¤.",
    "ì˜¤ë‹µì„ ë¶„ì„í•˜ì—¬ ê³µë¶€ ë°©í–¥ì„ ì¡°ì •í•œë‹¤.",
    "ëª¨ë‘  í™œë™ì—ì„œ ì£¼ë„ì ìœ¼ë¡œ ì°¸ì—¬í•œë‹¤.",
    "ì–´ë ¤ìš´ ë‚´ìš©ì„ ë°˜ë³µí•´ì„œ íƒêµ¬í•´ë³¸ë‹¤.",
    "ë°°ìš´ ë‚´ìš©ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì„¤ëª…í•´ë³¸ë‹¤.",
    "ë‹¤ë¥¸ ì‚¬ëŒê³¼ í•™ìŠµí•  ë•Œ ë™ê¸°ë¶€ì—¬ê°€ ëœë‹¤."
]

CHOICES = ["â‘  ì „í˜€ ì•„ë‹ˆë‹¤", "â‘¡ ì•„ë‹ˆë‹¤", "â‘¢ ë³´í†µì´ë‹¤", "â‘£ ê·¸ë ‡ë‹¤", "â‘¤ ë§¤ìš° ê·¸ë ‡ë‹¤"]

st.subheader("ğŸ“˜ í•™ìŠµ ì„±í–¥ ì„¤ë¬¸ (30ë¬¸í•­)")

# ---------------------------------------------
# ì„¤ë¬¸ ë¬¸í•­ ì…ë ¥
# ---------------------------------------------
for i, question in enumerate(questions, start=1):
    st.write(f"**Q{i}. {question}**")
    st.radio("", CHOICES, key=f"q_{i}", horizontal=True)
    st.markdown("---")

# ---------------------------------------------
# 3) í•™ìŠµ ì„±í–¥ ë¶„ì„ ë²„íŠ¼
# ---------------------------------------------
if st.button("ğŸ§ª í•™ìŠµ ì„±í–¥ ë¶„ì„ ì‹œì‘"):
    responses_list = []
    missing = []
    for i in range(1, 31):
        val = st.session_state.get(f"q_{i}", None)
        if val is None:
            missing.append(i)
        else:
            responses_list.append(CHOICES.index(val)+1)
    if missing:
        st.warning(f"ëª¨ë“  ë¬¸í•­ì— ë‹µí•´ì£¼ì„¸ìš”. (ë¹„ì–´ìˆëŠ” ë¬¸í•­: {missing[:5]}{('...' if len(missing)>5 else '')})")
    else:
        responses_array = np.array(responses_list)

        # ì—­ëŸ‰ ê³„ì‚°
        Analytical_idx = [0, 2, 8, 14, 22]
        Collaborative_idx = [3, 4, 10, 11, 18, 19, 25]
        SelfDirected_idx = [1, 6, 7, 15, 16, 26]
        Questioning_idx = [5, 12, 13, 20, 21, 27, 28]

        Analytical = responses_array[Analytical_idx].mean()
        Collaborative = responses_array[Collaborative_idx].mean()
        SelfDirected = responses_array[SelfDirected_idx].mean()
        Questioning = responses_array[Questioning_idx].mean()

        profile_vector = np.array([Analytical, Collaborative, SelfDirected, Questioning]).reshape(1, -1)

        # ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸°
        try:
            scaler = joblib.load("scaler.pkl")
            kmeans = joblib.load("kmeans_model.pkl")
        except Exception as e:
            st.error(f"ëª¨ë¸ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: {e}")
            st.stop()

        profile_scaled = scaler.transform(profile_vector)
        cluster = int(kmeans.predict(profile_scaled)[0])

        # Strength Profile ì¹´ë“œ ì •ì˜
        strength_profile_map = {
            0: {"í•™ìŠµ ìŠ¤íƒ€ì¼ ë¶„ì„": [
                    "ê¸°ì´ˆ ê°œë… ì´í•´ì™€ ë°˜ë³µ í•™ìŠµì„ ì˜í•´ìš”.",
                    "ê°„ë‹¨í•œ ë¬¸ì œë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ í‘¸ëŠ” í™œë™ì„ ì¢‹ì•„í•´ìš”.",
                    "ë³µì¡í•œ ë¬¸ì œë¥¼ í˜¼ì íƒêµ¬í•˜ëŠ” ê²ƒì´ ë¶€ì¡±í•´ìš”.",
                    "ì‹¬í™” ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²½í—˜ì´ ì•½í•´ìš”."
                ],
                "ì´ë ‡ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì•„ìš”": [
                    "ë…¸íŠ¸ì— ê°œë…ê³¼ ì˜ˆì œ ë¬¸ì œë¥¼ ì •ë¦¬í•´ë³´ê¸°",
                    "ë¬¸ì œ í’€ì´ ê³¼ì •ì„ ë§ë¡œ ì„¤ëª…í•˜ë©° ë°˜ë³µ",
                    "ì‰¬ìš´ ë¬¸ì œë¶€í„° ë‹¨ê³„ë³„ë¡œ ì—°ìŠµí•˜ì—¬ ìì‹ ê° ìŒ“ê¸°"
                ],
                "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•Œ ì—­í• ": [
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•ŒëŠ” â€˜íƒí—˜ê°€â€™ ì—­í• ì„ ë§¡ì•„, í™œë™ ê³„íšê³¼ ê¸°ë³¸ ê°œë…ì„ ì œì‹œí•˜ë©´ ì¢‹ì•„ìš”."
                ]
            },
            1: {"í•™ìŠµ ìŠ¤íƒ€ì¼ ë¶„ì„": [
                    "ë…¼ë¦¬ì ìœ¼ë¡œ ë¬¸ì œë¥¼ ë¶„ì„í•˜ê³  ì²´ê³„ì ìœ¼ë¡œ í‘¸ëŠ” ê²ƒì„ ì˜í•´ìš”.",
                    "í˜¼ìì„œ ë‹¨ê³„ë³„ ë¬¸ì œ í•´ê²°ê³¼ ê³„íš ì„¸ìš°ê¸°ë¥¼ ì¢‹ì•„í•´ìš”.",
                    "í˜‘ë ¥ í•™ìŠµì´ë‚˜ í† ë¡ ì„ í†µí•œ ì´í•´ëŠ” ë¶€ì¡±í•´ìš”.",
                    "ì°½ì˜ì  ë¬¸ì œ ì ‘ê·¼ ê²½í—˜ì´ ì•½í•´ìš”."
                ],
                "ì´ë ‡ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì•„ìš”": [
                    "ë¬¸ì œ í’€ì´ ê³„íší‘œ ì‘ì„± í›„ í˜¼ì í’€ì´",
                    "ì–´ë ¤ìš´ ë¬¸ì œë¥¼ ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ í•´ê²°í•˜ë©° ì‚¬ê³ ë ¥ í™•ì¥",
                    "í’€ì´ ê³¼ì •ì„ ê¸€ë¡œ ì •ë¦¬í•˜ì—¬ ë…¼ë¦¬ êµ¬ì¡° ì ê²€"
                ],
                "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•Œ ì—­í• ": [
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•ŒëŠ” â€˜ë¶„ì„ê°€â€™ ì—­í• ì„ ë§¡ì•„, ë¬¸ì œ ì ‘ê·¼ ë°©ë²•ê³¼ ì „ëµì„ ì œì‹œí•˜ë©´ ì¢‹ì•„ìš”."
                ]
            },
            2: {"í•™ìŠµ ìŠ¤íƒ€ì¼ ë¶„ì„": [
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•˜ê³  í† ë¡ í•˜ë©° ì´í•´í•˜ëŠ” ê²ƒì„ ì˜í•´ìš”.",
                    "ê·¸ë£¹ í™œë™ê³¼ ë°œí‘œë¥¼ ì¢‹ì•„í•´ìš”.",
                    "í˜¼ìì„œ ê³„íš ì„¸ìš°ê³  ë¬¸ì œë¥¼ ë¶„ì„í•˜ëŠ” ëŠ¥ë ¥ì€ ë¶€ì¡±í•´ìš”.",
                    "ìê¸°ì£¼ë„ì  í•™ìŠµ ê²½í—˜ì´ ì•½í•´ìš”."
                ],
                "ì´ë ‡ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì•„ìš”": [
                    "ê·¸ë£¹ í† ë¡ ê³¼ ë°œí‘œë¥¼ í†µí•´ ë¬¸ì œ í’€ì´ ê³µìœ ",
                    "ë¬¸ì œë¥¼ ì„œë¡œ ì„¤ëª…í•˜ê³  ì—­í•  ë¶„ë‹´ í›„ ê²°ê³¼ ì •ë¦¬",
                    "ê¸€ì“°ê¸°ë‚˜ ë§ë¡œ ì„¤ëª…í•˜ê¸°ë¡œ ì´í•´í•œ ë‚´ìš©ì„ ê¸°ë¡"
                ],
                "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•Œ ì—­í• ": [
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•ŒëŠ” â€˜ì„¤ëª…ê°€â€™ ì—­í• ì„ ë§¡ì•„, ì´í•´í•œ ë‚´ìš©ì„ ê³µìœ í•˜ë©´ ì¢‹ì•„ìš”."
                ]
            },
            3: {"í•™ìŠµ ìŠ¤íƒ€ì¼ ë¶„ì„": [
                    "ë³µì¡í•œ ë¬¸ì œë¥¼ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ íƒêµ¬í•˜ê³  í•´ê²°í•˜ëŠ” ê²ƒì„ ì˜í•´ìš”.",
                    "ì‹¬í™” ë¬¸ì œì™€ ì‘ìš© í™œë™ì„ ì¢‹ì•„í•´ìš”.",
                    "ê¸°ì´ˆ ê°œë… ë°˜ë³µ í•™ìŠµì€ ë¶€ì¡±í•´ìš”.",
                    "í•™ìŠµ ë£¨í‹´ ê´€ë¦¬ ê²½í—˜ì´ ì•½í•´ìš”."
                ],
                "ì´ë ‡ê²Œ ê³µë¶€í•˜ë©´ ì¢‹ì•„ìš”": [
                    "ë¬¸ì œ ë³€í˜• ë° ì‘ìš© ë¬¸ì œë¥¼ ìŠ¤ìŠ¤ë¡œ í’€ì–´ë³´ê¸°",
                    "í•™ìŠµ ë‚´ìš©ì„ ê¸€ë¡œ ì •ë¦¬í•˜ê±°ë‚˜ ì¹œêµ¬ì—ê²Œ ì„¤ëª…",
                    "ê¸°ì´ˆ ê°œë… ë³µìŠµê³¼ ì‹¤ìˆ˜ ë¶„ì„ìœ¼ë¡œ ì•½ì  ë³´ì™„"
                ],
                "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•Œ ì—­í• ": [
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•  ë•ŒëŠ” â€˜ë¬¸ì œ í•´ê²°ì‚¬â€™ ì—­í• ì„ ë§¡ì•„, ì–´ë ¤ìš´ ë¬¸ì œë¥¼ ì‹œë„í•˜ê³  ì „ëµì„ ê³µìœ í•˜ë©´ ì¢‹ì•„ìš”."
                ]
            }
        }

        # session_stateì— ì €ì¥
        st.session_state.update({
            "Analytical": Analytical,
            "Collaborative": Collaborative,
            "SelfDirected": SelfDirected,
            "Questioning": Questioning,
            "cluster": cluster,
            "strength_profile": strength_profile_map[cluster]
        })

        # CSV ë¶ˆëŸ¬ì™€ì„œ partner ë§¤ì¹­
        try:
            df_students_raw = pd.read_csv("real_students.csv")
            st.session_state['students_processed'] = match_partners(df_students_raw)
        except Exception as e:
            st.error(f"í•™ìƒ ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: {e}")
            st.session_state['students_processed'] = pd.DataFrame(columns=['ID','grade','Cluster','Cluster_Name','Recommended_Partner'])

# ---------------------------------------------
# 4) ê²°ê³¼ ì¶œë ¥ (ë¶„ì„ ê²°ê³¼ + Strength Profile)
# ---------------------------------------------
if 'cluster' in st.session_state:
    cluster = st.session_state['cluster']
    Analytical = st.session_state['Analytical']
    Collaborative = st.session_state['Collaborative']
    SelfDirected = st.session_state['SelfDirected']
    Questioning = st.session_state['Questioning']
    strength_profile = st.session_state['strength_profile']

    cluster_name_map = {0:"ë³‘ì•„ë¦¬ íƒí—˜ê°€ ğŸ£",1:"ë…¼ë¦¬ì™• ğŸ¤“",2:"ì¹œêµ¬ì™• ğŸ¦„",3:"ë¬¸ì œ í•´ê²° ë§ˆìŠ¤í„° ğŸ•µï¸â€â™‚ï¸"}
    partner_map = {
        0:"í•™ìŠµ ë£¨í‹´ì´ ì˜ ì¡í˜€ ìˆëŠ” 'ë¬¸ì œ í•´ê²° ë§ˆìŠ¤í„° ğŸ•µï¸â€â™‚ï¸' ì¹œêµ¬ì™€ í•¨ê»˜í•˜ë©´ ê¸°ë³¸ê¸° í˜•ì„±ì´ ë¹ ë¥´ê³ , ë‹¤ì–‘í•œ ë¬¸ì œ í•´ê²° ê²½í—˜ì„ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        1:"í˜‘ë ¥Â·ì†Œí†µì´ ê°•í•œ 'ì¹œêµ¬ì™• ğŸ¦„' ì¹œêµ¬ì™€ í˜ì–´ë¥¼ ì´ë£¨ë©´ ì´í•´í­ì´ ë„“ì–´ì§€ê³ , í˜‘ë ¥ í•™ìŠµì„ í†µí•´ ì‚¬íšŒì„±ë„ í•¨ê»˜ ì„±ì¥í•©ë‹ˆë‹¤.",
        2:"'ë…¼ë¦¬ì™• ğŸ¤“' ì¹œêµ¬ì™€ í•¨ê»˜í•˜ë©´ ì‚¬ê³ ë ¥ì´ ê· í˜• ìˆê²Œ ì„±ì¥í•˜ê³ , ê³„íšì  ë¬¸ì œ í•´ê²°ê³¼ ë¶„ì„ ëŠ¥ë ¥ì„ ë°°ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        3:"'ë³‘ì•„ë¦¬ íƒí—˜ê°€ ğŸ£' ì¹œêµ¬ì™€ í•¨ê»˜ í™œë™í•˜ë©´ ê¸°ì´ˆ ê°œë… ì´í•´ë¥¼ ë³´ì™„í•˜ê³ , í•™ìŠµ ë£¨í‹´ì„ ì¡ëŠ” ì—°ìŠµê³¼ ë¬¸ì œ í’€ì´ ìŠµê´€ í˜•ì„±ì— ë„ì›€ì´ ë©ë‹ˆë‹¤."
    }

    st.subheader("ğŸ“Œ ë¶„ì„ ê²°ê³¼ ìš”ì•½")
    st.metric("ì˜ˆì¸¡ëœ í•™ìŠµì ìœ í˜•", cluster_name_map[cluster])

    col1, col2 = st.columns(2)
    with col1:
        st.write("### ğŸ¯ ë‚˜ì˜ ì—­ëŸ‰ ì ìˆ˜")
        st.write(f"- **Analytical(ë¶„ì„ì„±)**: {Analytical:.2f}/5.00")
        st.write(f"- **Collaborative(í˜‘ë ¥ì„±)**: {Collaborative:.2f}/5.00")
        st.write(f"- **Self-Directed(ìê¸°ì£¼ë„)**: {SelfDirected:.2f}/5.00")
        st.write(f"- **Questioning(íƒêµ¬Â·ì§ˆë¬¸ì„±)**: {Questioning:.2f}/5.00")
    with col2:
        st.write("### ğŸ¤ ì¶”ì²œ í•˜ë¸Œë£¨íƒ€ íŒŒíŠ¸ë„ˆ ìœ í˜•")
        st.info(partner_map[cluster])

    st.divider()
    st.subheader("ğŸ“‡ ë‚˜ì˜ Strength Profile ì¹´ë“œ")
    for title, points in strength_profile.items():
        points_html = "".join([f"<p style='margin:5px 0;'>- {p}</p>" for p in points])
        st.markdown(
            f"""
            <div style="
                background-color:#f0f4f8; 
                padding:18px; 
                border-radius:12px; 
                margin-bottom:12px;
                box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
            ">
                <h4 style="color:#1f4e79;">{title}</h4>
                {points_html}
            </div>
            """,
            unsafe_allow_html=True
        )

# ---------------------------------------------
# 5) í•™ìŠµ ë©”ì´íŠ¸ ì¶”ì²œ (ìµœëŒ€ 3ëª…, ë³´ì™„í˜•/ìœ ì‚¬í˜•)
# ---------------------------------------------
complement_map = {0:3,1:2,2:1,3:0}  # ë³´ì™„í˜• ë§¤í•‘

if 'cluster' in st.session_state:
    df_students = st.session_state.get('students_processed', pd.DataFrame(columns=['ID','grade','Cluster']))
    st.divider()
    st.subheader("ğŸ§‘â€ğŸ¤â€ğŸ§‘ í•™ìŠµ ë©”ì´íŠ¸ ì¶”ì²œë°›ê¸°")
    col1, col2 = st.columns(2)

    with col1:
        if st.button("ğŸ’¡ ë‚˜ì˜ ë‹¨ì ì„ ë³´ì™„í•´ì¤„ í•™ìŠµ ë©”ì´íŠ¸"):
            cluster = st.session_state['cluster']
            target_cluster = complement_map[cluster]
            st.write("cluster:", cluster)
            st.write("target_cluster:", target_cluster)
            st.write("df_students['Cluster'].unique():", df_students['Cluster'].unique())
            st.write("df_students.shape:", df_students.shape)

            recommended = df_students[df_students['Cluster']==target_cluster][['ID','grade']].head(3)
            st.subheader("ğŸ¯ ì¶”ì²œ í•™ìŠµ ë©”ì´íŠ¸ (ë³´ì™„í˜•)")
            st.dataframe(recommended.reset_index(drop=True))

    with col2:
        if st.button("ğŸ¤ ë‚˜ì™€ ë¹„ìŠ·í•œ í•™ìŠµ ë©”ì´íŠ¸"):
            cluster = st.session_state['cluster']
            recommended = df_students[df_students['Cluster']==cluster][['ID','grade']].head(3)
            st.subheader("ğŸ¯ ì¶”ì²œ í•™ìŠµ ë©”ì´íŠ¸ (ìœ ì‚¬í˜•)")
            st.dataframe(recommended.reset_index(drop=True))
